import os
import json
import pandas as pd
from reV.config.project_points import ProjectPoints
from reV.config.project_points import PointsControl
from reV.generation.generation import Gen
from rex import init_logger
init_logger("reV.generation", log_level="DEBUG", log_file="./rev.log")
init_logger("reV.config", log_level="DEBUG", log_file="./rev.log")

lat_lon = [[22.781303, 86.20308],
 [23.83921, 86.32123],
 [20.484612, 82.50447],
 [24.4953, 87.4077],
 [20.318504, 85.34007],
 [21.284912, 84.04042],
 [25.075974, 83.72193],
 [25.263107, 83.781006],
 [19.429611, 82.53400400000002],
 [21.769989, 85.55325],
 [18.395737, 82.002335],
 [24.593475, 86.08493],
 [24.700867, 84.046844],
 [24.270767000000006, 86.705215],
 [19.12291, 83.124756],
 [26.432709000000006, 84.16499],
 [20.899094, 84.89701],
 [21.257393, 83.83366],
 [20.595253, 86.72833],
 [25.982193, 85.22834],
 [25.423279, 84.51944],
 [19.596657, 83.77458],
 [20.512276, 83.62689],
 [24.16301, 84.460365],
 [24.414635, 87.1714]]

sam_config = {
    "adjust:constant": 0,
    "system_capacity": 1620,
    "wind_farm_losses_percent": 16.7,
    "wind_farm_wake_model": 0,
    "wind_farm_xCoordinates": [
        0
    ],
    "wind_farm_yCoordinates": [
        0
    ],
    "wind_resource_model_choice": 0,
    "wind_resource_shear": 0.140000001,
    "wind_resource_turbulence_coeff": 0.1,
    "wind_turbine_hub_ht": 80,
    "wind_turbine_powercurve_powerout": [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        9,
        16,
        49,
        81,
        122,
        163,
        211,
        259,
        319,
        378,
        441,
        504,
        574,
        643,
        726,
        808,
        896,
        984,
        1072,
        1159,
        1236,
        1312,
        1369,
        1426,
        1473,
        1519,
        1545,
        1571,
        1583,
        1594,
        1602,
        1609,
        1614,
        1619,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        1620,
        0
    ],
    "wind_turbine_powercurve_windspeeds": [
        0,
        0.25,
        0.5,
        0.75,
        1,
        1.25,
        1.5,
        1.75,
        2,
        2.25,
        2.5,
        2.75,
        3,
        3.25,
        3.5,
        3.75,
        4,
        4.25,
        4.5,
        4.75,
        5,
        5.25,
        5.5,
        5.75,
        6,
        6.25,
        6.5,
        6.75,
        7,
        7.25,
        7.5,
        7.75,
        8,
        8.25,
        8.5,
        8.75,
        9,
        9.25,
        9.5,
        9.75,
        10,
        10.25,
        10.5,
        10.75,
        11,
        11.25,
        11.5,
        11.75,
        12,
        12.25,
        12.5,
        12.75,
        13,
        13.25,
        13.5,
        13.75,
        14,
        14.25,
        14.5,
        14.75,
        15,
        15.25,
        15.5,
        15.75,
        16,
        16.25,
        16.5,
        16.75,
        17,
        17.25,
        17.5,
        17.75,
        18,
        18.25,
        18.5,
        18.75,
        19,
        19.25,
        19.5,
        19.75,
        20,
        20.25,
        20.5,
        20.75,
        21,
        21.25,
        21.5,
        21.75,
        22,
        22.25,
        22.5,
        22.75,
        23,
        23.25,
        23.5,
        23.75,
        24,
        24.25,
        24.5,
        24.75,
        25,
        25.25
    ],
    "wind_turbine_rotor_diameter": 77,
    "timezone": 0
    }


WIND = "/nrel/wtk/india/wtk_india_2014.h5"

config_path = os.path.expanduser('sam_config.json')
with open(config_path, "w") as file:
    file.write(json.dumps(sam_config, indent=4))
sam_file = os.path.expanduser('sam_config.json')

pp = ProjectPoints.lat_lon_coords(lat_lon, WIND, sam_file, tech="windpower")
pc = PointsControl(pp, sites_per_split=1)

gen = Gen.reV_run(tech='windpower', points=pc, sam_files=sam_file,
                                res_file=WIND, max_workers=1, fout=None,
                                output_request=("cf_mean", "cf_profile"))